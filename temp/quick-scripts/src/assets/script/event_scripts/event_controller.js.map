{"version":3,"sources":["assets\\script\\event_scripts\\event_controller.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class event_controller extends cc.Component {\r\n    @property(cc.Prefab)\r\n    event: cc.Prefab = null\r\n\r\n    //@property(cc.Prefab)\r\n    //bar: cc.Prefab = null\r\n\r\n    @property(cc.Prefab)\r\n    button: cc.Prefab = null\r\n\r\n    @property(cc.Prefab)\r\n    exausted_prompt: cc.Prefab = null\r\n\r\n    @property(cc.Prefab)\r\n    event_description: cc.Prefab = null\r\n\r\n    @property\r\n    benefit_exp: number = 0\r\n\r\n    @property\r\n    benefit = null\r\n\r\n    @property\r\n    limited_event_record = null\r\n\r\n    dispatched_events = []\r\n    num_dispatched = 0\r\n\r\n    /*\r\n    clear_event()\r\n    {\r\n        for (let i = 0; i < this.ents.length; ++i)\r\n        {\r\n            this.ents[i].destroy()\r\n            console.debug('attempt to del '.concat(String(i)))\r\n        }\r\n    }\r\n    */\r\n\r\n    trim_segm(text: string)\r\n    {\r\n        let c = 0;\r\n        for (let i = 1; i < text.length+1; ++i)\r\n        {\r\n            if (text[i-1]=='\\n') c = 0\r\n            c++;\r\n            if (c % 12 == 0)\r\n            {\r\n                text = text.slice(0, i) + '\\n' + text.slice(i)\r\n            }\r\n        }\r\n        return text+'\\n'\r\n    }\r\n\r\n    dispatch_event()\r\n    {\r\n        this.num_dispatched += 1\r\n        //console.debug('pop from:')\r\n        //console.debug(this.dispatched_events[this.num_dispatched-1])\r\n        return this.dispatched_events[this.num_dispatched-1]\r\n    }\r\n\r\n    event_describe(description: string)\r\n    {\r\n\r\n        description = this.trim_segm(description)\r\n        let node = cc.instantiate(this.event_description)\r\n        node.setParent(this.node)\r\n        node.setPosition(new cc.Vec2(-427, 950))\r\n        node.setScale(new cc.Vec2(3,3))\r\n        node.getComponentInChildren(cc.Label).string = description\r\n        //node.getChildByName('event_prompt').color = cc.Color.ORANGE\r\n    }\r\n\r\n    exausted()\r\n    {\r\n        //+动画啥的\r\n        let node = cc.instantiate(this.exausted_prompt)\r\n        node.setParent(this.node)\r\n        node.setPosition(new cc.Vec2(-427, 950))\r\n        node.setScale(new cc.Vec2(3,3))\r\n        //console.debug(node.parent.name)\r\n        cc.find('persist_node').getComponent('persist_node').getComponent('persist_node').log_write('在'+\r\n            cc.find('persist_node').getComponent('persist_node').getAge().toString()+\r\n            '岁，你贪功好进，结果精疲力竭，元气大伤，殚精竭虑之事也一件不成。修炼虽好，可不要贪杯哦。')\r\n        this.benefit_exp = 0\r\n        cc.find('persist_node').getComponent('persist_node').event_permitted = false\r\n    }\r\n\r\n    init_event()\r\n    {\r\n        //console.debug('Init Events...')\r\n        //let cur = this.node.getPosition()\r\n        let p_node = cc.find('persist_node').getComponent('persist_node')\r\n        let test = p_node.dispatch_event_without_requirement(0)\r\n        \r\n        let pos = [new cc.Vec2(-727, 1180), new cc.Vec2(-427, 1180), new cc.Vec2(-127, 1180), new cc.Vec2(-560, 770), new cc.Vec2(-240, 770)]\r\n        //在controller选定事件,在event选定分支及代价\r\n        let events = p_node.dispatch_event(cc.find('awakener').getComponent('awakener').event_group, 2, 3)\r\n\r\n        for (let i = 0; i < 5; ++i) \r\n        {\r\n            //还可以在此处处理事件前置关系\r\n            let ent = events[i]\r\n            //console.debug(typeof(ent[1]))\r\n            \r\n            let types = ent[1].toString().split('，')\r\n            let threld = p_node.get_avg_attr()*(1-p_node.rec_gaussian(0.2, 0.2, -0.1, 0.5))\r\n            while ((types.length==3 && this.limited_event_record.has(ent[0].trim())) || \r\n                    (types[0].trim()!='0' && types[0].trim()!='_' && types[0].split('：')[0]!='特殊' && p_node.get_attr(types[0])<=threld) ||\r\n                    (types[0].split('：')[0]=='特殊' && p_node.get_attr(types[0])!=1))\r\n            //如果其为单次出现的事件并且已经出现过，或者其不满足触发门槛\r\n            //先进行事件类型判断，类型为 1_2[_3], 123是不同属性名称，1决定事件是否出现，2决定分支和收益系数，3决定事件是否只出现一次\r\n            {\r\n                console.debug('该事件不满足要求,重新发事件')\r\n                ent = p_node.dispatch_event_without_requirement(cc.find('awakener').getComponent('awakener').event_group)\r\n                //console.debug(ent)\r\n                types = ent[1].toString().split('，')\r\n            }\r\n            \r\n            let node = cc.instantiate(this.event)\r\n            node.setParent(this.node)\r\n            node.setPosition(pos[i])\r\n            node.setScale(new cc.Vec2(1,1))\r\n            //node.getChildByName('title').getComponent(cc.Label).string = ent[0]\r\n            //console.debug('init dispatch:')\r\n            //console.debug([ent[0].toString(), ent[1].toString(), ent[2].toString(), ent[3].toString()])\r\n            this.dispatched_events.push([ent[0].toString(), ent[1].toString(), ent[2].toString(), ent[3].toString()])\r\n            if (ent[1].toString().split('，').length==3) this.limited_event_record.set(ent[0].trim(), true)\r\n            //console.debug(events[i][1])\r\n            //console.debug(node.getContentSize().toString())\r\n            //console.debug(node.getPosition().x)\r\n            //this.ents.push(node)\r\n            /**/\r\n        }\r\n\r\n    }\r\n\r\n\r\n    init_bar_button()\r\n    {\r\n        //console.debug('Init widgets...')\r\n        /*\r\n        let node = cc.instantiate(this.bar)\r\n        node.setParent(this.node)\r\n        node.setPosition(new cc.Vec2(-550, 210))\r\n        node.setScale(new cc.Vec2(1,1))\r\n        */\r\n        let node = cc.instantiate(this.button)\r\n        node.setParent(this.node)\r\n        node.setPosition(new cc.Vec2(-150, 210))\r\n        //node.setPosition()\r\n        node.setScale(new cc.Vec2(1,1))\r\n\r\n    }\r\n    /*\r\n    next()\r\n    {\r\n        \r\n        this.node.getChildByName('progressBar').getComponent('bar').reset()\r\n    }\r\n    */\r\n\r\n    gameover()\r\n    {\r\n        \r\n    }\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.benefit = new Map()//记录所有事件结算得到的总收益\r\n        this.limited_event_record = new Map()//记录\r\n        this.init_event()\r\n        this.init_bar_button()   \r\n        \r\n    }\r\n\r\n    start () {\r\n        this.node.on('over', ()=>{\r\n            //console.debug('over')\r\n            let p_node = cc.find('persist_node').getComponent('persist_node')\r\n            p_node.addAge()\r\n            if (p_node.getAge()==p_node.age_limited) this.gameover()\r\n            if (cc.find('persist_node').getComponent('persist_node').event_permitted) // 并非是在exausted后才点击over按钮\r\n            {\r\n                //结算事件总收益\r\n                if (this.benefit.has('修为')) p_node.exp_gain(this.benefit.get('修为'))\r\n                let attr = Array.from(this.benefit)\r\n                console.debug(attr)\r\n                for (let i = 0; i < attr.length; ++i)\r\n                {\r\n                    if (attr[i][0]!='修为') p_node.change_attr(attr[i][0], attr[i][1])\r\n                }\r\n            }\r\n            \r\n            //放出事件唤醒按钮，回收事件\r\n            p_node.focus = null\r\n            cc.find('awakener').active = true\r\n            this.node.destroy()\r\n        })\r\n        \r\n        this.node.on('exausted', ()=>{\r\n            console.debug('exausted')\r\n            this.exausted()\r\n        })\r\n        /*\r\n        this.node.on('recover', ()=>{\r\n            console.debug('recover')\r\n            this.recover()\r\n        })\r\n        \r\n        this.node.on(cc.Node.EventType.TOUCH_START, (event)=>{\r\n            this.awake()\r\n        })\r\n        */\r\n    }\r\n    \r\n    update (dt) {\r\n        //if (cc.find('persist_node').getComponent('persist_node').getEnergy() > 0)\r\n    }\r\n    /*\r\n    destroy(): boolean {\r\n        let paren = this.node.getParent()\r\n        let n = cc.instantiate(cc.find('event_control'))\r\n        n.setParent(paren)\r\n        return true\r\n    }\r\n    */\r\n    \r\n}\r\n"]}