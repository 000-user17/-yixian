{"version":3,"sources":["assets\\script\\scene2\\fanhui.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class fanhui extends cc.Component {\r\n\r\n    @property(cc.Prefab)\r\n    defeat:cc.Prefab = null;\r\n\r\n    @property(cc.Prefab)\r\n    success:cc.Prefab = null;\r\n\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n\r\n    /**\r\n\t * 生成范围随机数\r\n\t * @Min 最小值\r\n\t * @Max 最大值\r\n     * 给予不同节点相同的脚本，每个节点都会分别执行一次改脚本的start等方法\r\n\t */\r\n\tpublic GetRandomNum(Min, Max):number {\r\n\t\tvar Range = Max - Min;\r\n\t\tvar Rand = Math.random();\r\n\t\treturn (Min + Math.round(Rand * Range));\r\n\t}\r\n\r\n    //突破分支对应突破不同情况的效果\r\n    tupo(){\r\n\r\n        let dantian = cc.find('dantian').getComponent('dantian');\r\n\r\n        let persist = cc.find('persist_node').getComponent('persist_node'); //获取常驻节点\r\n        \r\n                //丹田值如果超过了最大丹田量的不良影响\r\n                if(dantian.explosion > 0){\r\n                    cc.find('persist_node').getComponent('persist_node').exp_now = 0 ; //如果丹田值爆满，会有惩罚,扣除一半经验值\r\n                    cc.find('persist_node').getComponent('persist_node').changeEnergy(-200); //扣除200点精力值\r\n                    cc.find('persist_node').getComponent('persist_node').log_write('丹田值爆炸，精力值和经验值都下降')\r\n\r\n                    //随机降低2次属性\r\n                    for(let i= 0 ; i<2 ; ++i){\r\n                        let att_id = this.GetRandomNum(0,8); //随机提升某一项属性\r\n                        let att_name = persist.attribute_name[att_id];  //获得相应的属性名\r\n                        if(persist.get_attr(att_name) == 0){\r\n                            persist.change_attr(att_name, 0); //改变对应的属性，增加一点\r\n                        }\r\n                        \r\n                        else{\r\n                            persist.change_attr(att_name, -30); //改变对应的属性，增加一点\r\n                        }\r\n                        \r\n                    }\r\n\r\n\r\n                    let defeat = cc.instantiate(this.defeat);\r\n                    defeat.setParent(cc.director.getScene());\r\n\r\n                    cc.loader.loadRes(\"失败\", cc.AudioClip, (res,clip)=>{\r\n                        //播放音乐\r\n                        let audioID: number = cc.audioEngine.playEffect(clip, false);\r\n                        cc.audioEngine.setVolume(audioID, 0.8);\r\n                        //停止播放音乐\r\n                        //cc.audioEngine.stop(audioID);\r\n                    });\r\n\r\n\r\n\r\n                }\r\n                //如果丹田值没超\r\n                else{\r\n                    let tupo_num  = cc.find('dantian').getComponent('dantian').tupo_num;\r\n                    let levelup_prob = 0.6*(dantian.get_dantian()/dantian.dantian_max()) + 0.4*tupo_num/9 ;  //突破概率\r\n\r\n                    let random = this.GetRandomNum(0,10000); //这边的随机值需要更改\r\n                    /*\r\n                    console.debug(random);\r\n                    console.debug(levelup_prob*10000);\r\n                    cc.find('persist_node').getComponent('persist_node').up_level()//突破成功等级加1\r\n                    cc.find('persist_node').getComponent('persist_node').log_write(\"成功突破,等级加1 !!!\");\r\n                    cc.find('persist_node').getComponent('persist_node').exp_now = 0;\r\n                    */\r\n                   //突破成功\r\n                    if(random<=levelup_prob*10000){\r\n                        cc.find('persist_node').getComponent('persist_node').up_level()//突破成功等级加1\r\n                        cc.find('persist_node').getComponent('persist_node').log_write(\"成功突破,等级加1 !!!\");\r\n                        cc.find('persist_node').getComponent('persist_node').exp_now = 0;\r\n\r\n                        //所有属性随机增加\r\n                        for(let i= 0 ; i<9 ; ++i){\r\n                            let att_add = this.GetRandomNum(50,100); //随机提升某一项属性\r\n                            let att_name = persist.attribute_name[i];  //获得相应的属性名\r\n                        \r\n                            persist.change_attr(att_name, att_add); //改变对应的属性，增加一点\r\n                        \r\n                        }\r\n\r\n                        let success = cc.instantiate(this.success);\r\n                        success.setParent(cc.director.getScene());\r\n\r\n                        cc.loader.loadRes(\"成功\", cc.AudioClip, (res,clip)=>{\r\n                            //播放音乐\r\n                            let audioID: number = cc.audioEngine.playEffect(clip, false);\r\n                            cc.audioEngine.setVolume(audioID, 0.8);\r\n                            //停止播放音乐\r\n                            //cc.audioEngine.stop(audioID);\r\n                        });\r\n\r\n\r\n                    }\r\n                    //突破失败\r\n                    else{\r\n                        cc.find('persist_node').getComponent('persist_node').log_write(\"突破失败,等级不变 !!!\");\r\n                        cc.find('persist_node').getComponent('persist_node').exp_now /= 2 ; //如果丹田值爆满，会有惩罚,扣除一半经验值\r\n                        let defeat = cc.instantiate(this.defeat);\r\n                        defeat.setParent(cc.director.getScene());\r\n\r\n                        //随机降低2次属性\r\n                        for(let i= 0 ; i<2 ; ++i){\r\n                            let att_id = this.GetRandomNum(0,8); //随机提升某一项属性\r\n                            let att_name = persist.attribute_name[att_id];  //获得相应的属性名\r\n                            if(persist.get_attr(att_name) == 0){\r\n                                persist.change_attr(att_name, 0); //改变对应的属性，增加一点\r\n                            }\r\n                        \r\n                            else{\r\n                                persist.change_attr(att_name, -30); //改变对应的属性，增加一点\r\n                            }\r\n                        \r\n                        }\r\n\r\n                        cc.loader.loadRes(\"失败\", cc.AudioClip, (res,clip)=>{\r\n                            //播放音乐\r\n                            let audioID: number = cc.audioEngine.playEffect(clip, false);\r\n                            cc.audioEngine.setVolume(audioID, 0.8);\r\n                            //停止播放音乐\r\n                            //cc.audioEngine.stop(audioID);\r\n                        });\r\n                    }\r\n                    \r\n\r\n                }\r\n\r\n    }\r\n\r\n    start () {\r\n        //触摸返回主场景，延时0.1秒返回, 可以针对不同的突破效果产生不同的动画，就类似于抽卡动画\r\n            this.node.on(cc.Node.EventType.TOUCH_START, (event)=>{\r\n                this.tupo();\r\n                \r\n                //延时进入主场景\r\n\r\n                setTimeout(()=>{\r\n                    cc.director.loadScene(\"main\");\r\n                }, 3000);\r\n        \r\n        });\r\n\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}