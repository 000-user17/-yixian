{"version":3,"sources":["assets\\script\\event_scripts\\bar.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class bar extends cc.Component {\r\n\r\n    @property\r\n    fatigue: number = 500;\r\n\r\n    @property\r\n    recover_inteval:number = 3;  //精力条每隔3秒恢复一次\r\n\r\n    \r\n    recover()\r\n    {\r\n        //+动画啥的\r\n        cc.find('persist_node').getComponent('persist_node').event_permitted = true\r\n        this.node.getChildByName('prompt').color = cc.Color.GREEN\r\n    }\r\n    \r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n\r\n    start () {\r\n        // for test\r\n        this.node.on(cc.Node.EventType.TOUCH_START,()=>{\r\n            //cc.find('persist_node').getComponent('persist_node').changeEnergy(100)\r\n        })\r\n    }\r\n\r\n    /*\r\n    this.fatigue += val\r\n    console.debug(this.fatigue)\r\n    this.node.getComponent(cc.ProgressBar).progress = this.fatigue/500.\r\n    if (this.fatigue >= 500.)\r\n    {\r\n        // this.settle() //结算再reset \r\n        console.debug('fatigue bomb and BEGIN NEXT ROUND INSTANTLY !!!')\r\n        this.node.dispatchEvent(new cc.Event.EventCustom(\"exausted\", true))\r\n        //this.node.getParent().getChildByName('button')\r\n        // 暂时不进行：this.node.getParent().getChildByName('button').getComponent('next').next()\r\n    } \r\n    */\r\n        //else this.getComponent(cc.ProgressBar).progress = this.fatigue / 500.\r\n        //console.debug('SET')\r\n\r\n    update (dt) {\r\n        let src = this.fatigue\r\n        this.fatigue = cc.find('persist_node').getComponent('persist_node').getEnergy()\r\n        this.fatigue = this.fatigue < 0 ? 0 : this.fatigue //filtering\r\n        \r\n        if (src != this.fatigue) //pn中的精力值发生了改变\r\n        {\r\n            //console.debug('Bar')\r\n            //console.debug(cc.find('event_controller').getComponent('event_controller').event_permitted)\r\n            //console.debug('target: '+String(this.fatigue))\r\n            this.schedule(()=>{\r\n                this.node.getComponent(cc.ProgressBar).progress += (this.fatigue-src)/500/5\r\n            }, dt, 5)\r\n            if (src <= 0 && this.fatigue > 0) this.recover()\r\n            /*\r\n            if (this.fatigue <= 0) //energy 变化的结果是让当前值变成<=0\r\n            {\r\n                console.debug('target: '+String(cc.find('persist_node').getComponent('persist_node').getEnergy()))\r\n                //this.getComponent(cc.ProgressBar) 变红一下：换个材质或红框的图\r\n                cc.find('event_controller').emit('exausted')\r\n            }\r\n            else this.recover()//energy 变化的结果是让当前值变成>0\r\n            */\r\n        }\r\n\r\n        \r\n        //精力条随时间恢复\r\n        if(this.recover_inteval >= 0){\r\n            this.recover_inteval -= dt\r\n        }\r\n        else{\r\n            cc.find('persist_node').getComponent('persist_node').changeEnergy(1);\r\n            this.recover_inteval = 3;\r\n        }\r\n        \r\n\r\n\r\n        //this.node.getChildByName('prompt').getComponent(cc.Label)\r\n        this.getComponentInChildren(cc.Label).string = Math.round(this.fatigue).toString() + ' / 500'\r\n        if (this.fatigue == 0) this.node.getChildByName('prompt').color = cc.Color.RED\r\n        \r\n    }\r\n}\r\n"]}