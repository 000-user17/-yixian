{"version":3,"sources":["assets\\script\\event_scripts\\event.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class event extends cc.Component {\r\n    @property\r\n    ent = null\r\n\r\n    //@property(cc.Prefab)\r\n    //description: cc.Prefab = null\r\n\r\n    //_random_price: number = 0\r\n    //_exp_gaining: number = 0\r\n\r\n    player: cc.Animation = null\r\n\r\n    @property\r\n    benefit_total: number = 0\r\n\r\n    show_event()\r\n    {\r\n        \r\n    }\r\n\r\n\r\n    open()\r\n    {\r\n        //打开事件之动画逻辑\r\n    }\r\n\r\n    diminish(tar: cc.Vec2)\r\n    {\r\n        let mv_action = cc.moveTo(0.5, tar)\r\n        let sc_action = cc.scaleTo(0.5, 0, 0)\r\n        \r\n        this.node.runAction(mv_action)\r\n        this.node.runAction(sc_action)\r\n        //this.node.destroy()\r\n        \r\n    }\r\n\r\n    clear()\r\n    {\r\n        this.destroy()\r\n    }\r\n\r\n    onLoad () {\r\n        //this._random_price = Math.random() * 400\r\n        //this._exp_gaining = Math.random() * 50 // 此处用这个随机数指代事件类型\r\n        //this.player = this.node.getComponent(cc.Animation)\r\n    }\r\n\r\n\r\n    start () {\r\n        /* dispatch one event to this node */\r\n        this.ent = this.node.getParent().getComponent('event_controller').dispatch_event()\r\n        let p_node = cc.find('persist_node').getComponent('persist_node')\r\n        //console.debug('pop finished')\r\n        //console.debug(this.ent)\r\n        this.node.getComponentInChildren(cc.Label).string = p_node.get_event_grade(0, this.ent[0]) + ':' + this.ent[0]\r\n        this.node.getChildByName('title').color = cc.Color.BLUE\r\n        this.node.on(cc.Node.EventType.TOUCH_START, ()=>{\r\n\r\n            cc.loader.loadRes(\"翻牌\", cc.AudioClip, (res,clip)=>{\r\n                //播放音乐\r\n                let audioID: number = cc.audioEngine.playEffect(clip, false);\r\n                cc.audioEngine.setVolume(audioID, 0.3);\r\n                //停止播放音乐\r\n                //cc.audioEngine.stop(audioID);\r\n            });\r\n            \r\n            if (p_node.event_permitted)\r\n            {\r\n                //console.debug(this.ent[0]+'map to '+p_node.get_event_energy(this.ent[0]).toString())\r\n                //console.debug(this.ent)\r\n                let price = Math.round(p_node.get_event_energy(0, this.ent[0]))\r\n                //this.ent[0] = 'GRADE: ' + p_node.get_event_grade(0, this.ent[0]) + this.ent[0]\r\n                //console.debug('touch the event : '+price.toString())\r\n                p_node.changeEnergy(-price)\r\n                if (p_node.getEnergy() <= 0) // 点下去爆了精力条，不需要进行事件逻辑判断\r\n                {\r\n                    //console.debug('exausted: '+String(cc.find('persist_node').getComponent('persist_node').getEnergy()))\r\n                    //this.getComponent(cc.ProgressBar) 变红一下：换个材质或红框的图\r\n                    cc.find('event_controller').emit('exausted')\r\n                }\r\n                else\r\n                {\r\n                    //先进行事件类型判断，类型为 1_2[_3], 123是不同属性名称， 1决定事件是否出现，2决定分支和收益系数，3决定事件是否只出现一次\r\n                    //this.show_event()\r\n                    /*\r\n                    console.debug('show this event:')\r\n                    console.debug(this.ent[0])\r\n                    console.debug(this.ent[1])\r\n                    console.debug(this.ent[2])\r\n                    console.debug(this.ent[3])\r\n                    console.debug('========end show========')\r\n                    */\r\n                    let type = this.ent[1].split('，')\r\n                    let settle_desc = ''\r\n                    if (type.length >= 2 && type[1]!='_')//需要进行分支判断和收益放缩\r\n                    {\r\n                        let branchs = this.ent[3].split('#')\r\n                        let threld = p_node.get_avg_attr()*(1-p_node.rec_gaussian(-0.1, 0.1, -0.3, 0.1))\r\n                        //console.debug(threld)\r\n                        //console.debug(threld.toString())\r\n                        if (p_node.get_attr(type[1]) >= threld)\r\n                        {\r\n                            //===>通过门槛, 事件总收益和price比例类近\r\n                            console.debug('pass the threld')\r\n                            this.ent[3] = branchs[0]+branchs[1]\r\n                            let scale = p_node.get_attr(type[1])/threld\r\n                            let rewards = this.ent[2].split('，')\r\n                            this.benefit_total = (price + p_node.gaussian_random(0, 5))*rewards.length*scale\r\n                            price = price*(1-(p_node.get_attr('灵根')-50)/100) // 代价需要跟着灵根有一定的浮动\r\n                            let remain_por = 1\r\n                            for (let i = 0; i < rewards.length; ++i)\r\n                            {\r\n                                if (rewards[i].split('：')[0]=='特殊')\r\n                                {\r\n                                    this.node.getParent().getComponent('event_controller').benefit.set(rewards[i], 1)\r\n                                    settle_desc += '\\n得到'+rewards[i].split('：')[1]+'。'\r\n                                }\r\n                                else\r\n                                {\r\n                                    let por = remain_por*p_node.rec_gaussian(0.4, 0.1, 0.2, 0.6)\r\n                                    let reward = Math.round(this.benefit_total*por/500*p_node.exp_required()/(2**p_node.level))\r\n                                    let cat = '+'\r\n                                    if (type[0] == '1')\r\n                                    {\r\n                                        cat = ''\r\n                                        reward = -reward\r\n                                    } \r\n                                    if (!this.node.getParent().getComponent('event_controller').benefit.has(rewards[i]))\r\n                                            this.node.getParent().getComponent('event_controller').benefit.set(rewards[i], reward)\r\n                                    else this.node.getParent().getComponent('event_controller').benefit.set(rewards[i], \r\n                                            this.node.getParent().getComponent('event_controller').benefit.get(rewards[i])+reward)\r\n                                    //因为寿命是指数级增加的，所以每个级别需要消耗的精力管数也是指数增加，而其他属性因为判定总是用均值所以无关紧要\r\n                                    settle_desc += '\\n'+rewards[i]+cat+' '+reward.toString()\r\n                                    remain_por -= por\r\n                                }\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            console.debug('not pass the threld')\r\n                            this.ent[3] = branchs[0]+branchs[2]\r\n                        }\r\n                    }\r\n                    else//无分支的事件\r\n                    {\r\n                        console.debug('no branch')\r\n                        let rewards = this.ent[2].split('，')\r\n                        this.benefit_total = (price + p_node.gaussian_random(0, 5))*rewards.length\r\n                        let norm = p_node.get_attr('灵根')\r\n                        price = price*(1-(norm-50)/100) // 代价需要跟着灵根有一定的浮动\r\n                        let remain_por = 1\r\n                        for (let i = 0; i < rewards.length; ++i)\r\n                        {\r\n                            if (rewards[i].split('：')[0]=='特殊')\r\n                            {\r\n                                this.node.getParent().getComponent('event_controller').benefit.set(rewards[i], 1) \r\n                                settle_desc += '\\n得到'+rewards[i].split('：')[1]+'。'\r\n                            }\r\n                            else if (i < rewards.length - 1)\r\n                            {\r\n                                let por = remain_por*p_node.rec_gaussian(0.5, 0.1, 0.2, 0.8)\r\n                                let cat = '+'\r\n                                let reward = Math.round(this.benefit_total*por/500*p_node.exp_required()/(2**p_node.level))\r\n                                if (type[0] == '1')\r\n                                {\r\n                                    cat = ''\r\n                                    reward = -reward\r\n                                } \r\n                                if (!this.node.getParent().getComponent('event_controller').benefit.has(rewards[i]))\r\n                                            this.node.getParent().getComponent('event_controller').benefit.set(rewards[i], reward)\r\n                                    else this.node.getParent().getComponent('event_controller').benefit.set(rewards[i], \r\n                                            this.node.getParent().getComponent('event_controller').benefit.get(rewards[i])+reward)\r\n                                settle_desc += '\\n'+rewards[i]+cat+' '+reward.toString()\r\n                                remain_por -= por\r\n                            }\r\n                            else\r\n                            {\r\n                                let cat = '+'\r\n                                let reward = Math.round(this.benefit_total*remain_por/500*p_node.exp_required()/(2**p_node.level))\r\n                                if (type[0] == '1')\r\n                                {\r\n                                    cat = ''\r\n                                    reward = -reward\r\n                                } \r\n                                if (!this.node.getParent().getComponent('event_controller').benefit.has(rewards[i]))\r\n                                            this.node.getParent().getComponent('event_controller').benefit.set(rewards[i], reward)\r\n                                    else this.node.getParent().getComponent('event_controller').benefit.set(rewards[i], \r\n                                            this.node.getParent().getComponent('event_controller').benefit.get(rewards[i])+reward)\r\n                                settle_desc += '\\n'+rewards[i]+cat+' '+reward.toString()\r\n                            }\r\n                        }\r\n                    }\r\n                    console.debug(settle_desc)\r\n                    this.node.getParent().getComponent('event_controller').event_describe(this.ent[3]+settle_desc)\r\n                    //console.debug(price)\r\n                    //console.debug(this.benefit_total*(p_node.exp_required()/500))\r\n                    p_node.getComponent('persist_node').log_write(this.ent[3])\r\n                }\r\n                this.diminish(new cc.Vec2(cc.find('energyBar').getComponent(cc.ProgressBar).progress*500-580, 210))\r\n                //console.debug(this.node.getPosition().x, this.node.getPosition().y)\r\n            }\r\n            else console.debug('been exausted!')\r\n        })\r\n\r\n    }\r\n\r\n    update (dt) {\r\n        \r\n        \r\n    }\r\n}\r\n"]}